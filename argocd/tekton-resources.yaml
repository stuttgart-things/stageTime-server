---
apiVersion: argoproj.io/v1alpha1
kind: Application
metadata:
  name: tekton-resources
  namespace: argocd
  annotations:
    argocd.argoproj.io/sync-wave: "-1"
spec:
  project: app
  destination:
    name: dev8
    namespace: yacht
    #server: 'https://10.100.136.78:6443'
  source:
    repoURL: eu.gcr.io/stuttgart-things
    chart: yacht-tekton-resources
    targetRevision: v0.47.3
    plugin:
      name: argocd-vault-plugin-helm
      env:
        - name: HELM_VALUES
          value: |
            defaultNamespace: yacht
            enableTasks: false
            enablePipelines: false

            enableWorkspaces: true
            workspaces:
              yacht-kaniko-workspace:
                volumeMode: Filesystem
                storageClassName: nfs4-csi
                storage: 5Gi
                accessModes:
                  - ReadWriteOnce

            enableGitSecretsSSH: true
            gitSecretsSSH:
              codehub:
                name: codehub-ssh
                labels:
                  app: yacht-tekton
                dataType: data
                secretKVs:
                  id_rsa: <path:apps/data/yacht#codehub-ssh>
              github:
                name: github-ssh
                labels:
                  app: yacht-tekton
                dataType: data
                secretKVs:
                  id_rsa: <path:apps/data/yacht#github-ssh>

            enableSecrets: true
            secrets:
              msteams:
                name: msteams
                labels:
                  app: yacht
                secretKVs:
                  url: <path:apps/data/yacht#msteams>

            enableRegistryCredentials: true
            registryCredentials:
              scr-labda:
                labels:
                  app: yacht-teton
                dockerConfigJson: <path:apps/data/yacht#scr-labda>
              eu-gcr:
                labels:
                  app: yacht-teton
                dockerConfigJson: <path:apps/data/yacht#eu-gcr>
            enableGitSecretsBasicAuth: false
            gitSecretsBasicAuth:
              codehub-basicauth:
                labels:
                  app: sthings-tekton
                namespace: tekton-cicd
                hostname: codehub.sva.de
                username: <path:apps/data/codehub#git_token_usernamee>
                password: <path:apps/data/codehub#git_token_password>
  syncPolicy:
    automated:
      prune: true
      selfHeal: true
    syncOptions:
      - CreateNamespace=true